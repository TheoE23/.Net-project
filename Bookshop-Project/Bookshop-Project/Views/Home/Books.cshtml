@using Bookshop_Project.Data
@using Microsoft.AspNetCore.Identity
@inject UserManager<User> userManager

<div class="row row-cols-3 g-3">
    @foreach (var result in Model)
    {
        <div class="col">
            <div class="card">
                @if (result.CoverUrl == "")
                {
                    <img src="../assets/alt.jpg" class="card-img-top" alt="" style="height: 400px" />
                }
                else
                {
                    <img src="@result.CoverUrl" class="card-img-top" alt="../assets/alt.jpg" style="height: 400px" />
                }
                <div class="card-body">
                    <h5 class="card-title">@result.Title</h5>
                    <p class="card-text">@result.Author</p>
                </div>

                @if (Context.User.Identity.IsAuthenticated && (await userManager.IsInRoleAsync(await userManager.GetUserAsync(Context.User), "Admin")))
                {
                    <button class="add-price" data-book-id="@result.key">Add Price</button>
                }
            </div>
        </div>
    }
</div>

@section scripts {
    <script>
        $(document).ready(function () {
            $('button.add-price').click(function () {
                var price = prompt("Enter the price:");
                if (price != null && price.trim() !== "") {
                    var bookId = $(this).data('book-id');
                    var url = '@Url.Action("AddPrice", "Home")';

                    $.ajax({
                        url: url,
                        type: 'POST',
                        data: { bookId: bookId, price: price },
                        success: function (response) {
                            console.log(response);
                        },
                        error: function (xhr, status, error) {
                            console.log(error);
                        }
                    });
                }
            });
        });
    </script>
}
